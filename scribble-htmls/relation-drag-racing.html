<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>miniKanren Drag Racing</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript">
(function() {
  document.write('<link rel="stylesheet" href="katex/katex.min.css" />');
})();(function() {document.write('<scr' + 'ipt type="text/javascript" src="katex/katex.min.js"></scr' + 'ipt>');})();(function(f) {
  // A "simple" onLoad function
  if (window.document.readyState == "complete") {
    f();
  } else if (window.document.addEventListener) {
    window.document.addEventListener("DOMContentLoaded", f, false);
  } else if (window.attachEvent) {
    window.attachEvent("onreadystatechange", function() {
      if (window.document.readyState == "complete") {
        f();
      }
    });
  } else {
    var oldLoad = window.onload;
    if (typeof(oldLoad) == "function") {
      window.onload = function() {
        try {
          oldLoad();
        } finally {
          f();
        }
      };
    } else {
      window.onload = f;
    }
  }
})(function() {
  // This is an ugly way to change the doctype, in case the scribble document
  // did not use (with-html5).
  if (!(document.doctype && document.doctype.publicId == '')) {
    if (console && console.log) {
      console.log("Re-wrote the document to use the HTML5 doctype.\n"
                  + "  Consider using the following declaration:\n"
                  + "      @title[#:style (with-html5 manual-doc-style)]{â€¦}");
    }
    var wholeDoc = '<!doctype HTML>\n' + document.documentElement.outerHTML;
    document.open();
    document.clear();
    document.write(wholeDoc);
  }
  var inlineElements = document.getElementsByClassName("texMathInline");
  for (var i = 0; i < inlineElements.length; i++) {
    var e = inlineElements[i];
    katex.render(e.textContent, e, { displayMode:false, throwOnError:false });
  }
  var displayElements = document.getElementsByClassName("texMathDisplay");
  for (var i = 0; i < displayElements.length; i++) {
    var e = displayElements[i];
    katex.render(e.textContent, e, { displayMode:true, throwOnError:false });
  }
});
</script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">mini<span class="mywbr"> &nbsp;</span>Kanren Drag Racing</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.The_straightforward_approach%29" class="tocviewlink" data-pltdoc="x">The straightforward approach</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Exploiting_the_structure_of_multiples_of_3%29" class="tocviewlink" data-pltdoc="x">Exploiting the structure of multiples of 3</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._.Enumerating_all_multiples_of_3%29" class="tocviewlink" data-pltdoc="x">Enumerating all multiples of 3</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._.Start_your_engines%29" class="tocviewlink" data-pltdoc="x">Start your engines</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="#%28part._.Ready__set__go_%29" class="tocviewlink" data-pltdoc="x">Ready, set, go!</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._mini.Kanren_.Drag_.Racing%29" class="tocsubseclink" data-pltdoc="x">mini<span class="mywbr"> &nbsp;</span>Kanren Drag Racing</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.The_straightforward_approach%29" class="tocsubseclink" data-pltdoc="x">The straightforward approach</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Exploiting_the_structure_of_multiples_of_3%29" class="tocsubseclink" data-pltdoc="x">Exploiting the structure of multiples of 3</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.Enumerating_all_multiples_of_3%29" class="tocsubseclink" data-pltdoc="x">Enumerating all multiples of 3</a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.Start_your_engines%29" class="tocsubseclink" data-pltdoc="x">Start your engines</a></td></tr><tr><td><span class="tocsublinknumber">5<tt>&nbsp;</tt></span><a href="#%28part._.Ready__set__go_%29" class="tocsubseclink" data-pltdoc="x">Ready, set, go!</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="versionNoNav">8.7</span></div><h2><a name="(part._mini.Kanren_.Drag_.Racing)"></a>miniKanren Drag Racing</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Brett Schreiber</p></span></div><p><div class="SIntrapara">This article documents my attempts at writing a relation in miniKanren which asserts for a given <span class="RktSym">x</span>:
</div><div class="SIntrapara"><ul><li><p><span class="RktSym">x</span> is an Oleg number (explained below)</p></li><li><p><span class="RktSym">x</span> is a multiple of 3. In other words, there exists some natural number <span class="texMathInline">n</span> such that <span class="texMathInline">x = 3n</span></p></li></ul></div></p><p><div class="SIntrapara">There are multiple ways to write this relation in miniKanren. In this article I will explore 4 candidate relation definitions and compare them in the following <span style="font-weight: bold">drag races</span>:
</div><div class="SIntrapara"><ul><li><p>Which relation can most quickly output the first 10000 multiples of 3?</p></li><li><p>Which relation can most quickly recognize 999999999 as being a multiple of 3?</p></li><li><p>Which relation can most quickly recognize 1000000000 as <span style="font-weight: bold">not</span> being a multiple of 3?</p></li></ul></div></p><p><div class="SIntrapara">An Oleg number is a list of bits whose least significant digit comes first, and whose last digit cannot be <span class="RktVal">0</span>. For example, <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktVal">)</span> is an Oleg number representing <span class="RktVal">4</span>. TRS2 defines the function <span class="RktSym">build-num</span> for converting a base ten number into an Oleg number. Below is the reverse definition, converting an Oleg number back into base ten: </div><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>All code in this article was executed using the miniKanren implementation from <span class="RktSym">TRS2</span><span class="RktMeta"></span>, but <span class="RktSym">faster-miniKanren</span><span class="RktMeta"></span> could also be used.</p></blockquote></blockquote></blockquote></div></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">base-ten</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">match</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktRdr">,</span><span class="RktSym">head</span><span class="hspace">&nbsp;</span><span class="RktVal">. </span><span class="RktRdr">,</span><span class="RktSym">tail</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktSym">head</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">base-ten</span><span class="hspace">&nbsp;</span><span class="RktSym">tail</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Now, onto the four implementations:</p><h3>1<tt>&nbsp;</tt><a name="(part._.The_straightforward_approach)"></a>The straightforward approach</h3><p>miniKanren excels at modeling facts of the form "there exists" by using the <span class="RktSym">fresh</span> keyword. Also, there is a well-understood relation <span class="RktPn">(</span><span class="RktSym">*o</span><span class="stt"> </span><span class="RktSym">a</span><span class="stt"> </span><span class="RktSym">b</span><span class="stt"> </span><span class="RktSym">c</span><span class="RktPn">)</span> which models facts of the form <span class="texMathInline">ab = c</span> where <span class="RktSym">a</span>, <span class="RktSym">b</span>, and <span class="RktSym">c</span> are Oleg numbers. Putting these together yields a first attempt at <span class="RktSym">multiple-of-3o</span>, which I will call the <span class="RktSym">3n</span> approach:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">defrel</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">multiple-of-3o-3n</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fresh</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">*o</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Knowing that <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktVal">)</span> is the Oleg number representing the constant <span class="RktVal">3</span>, this miniKanren relation directly encodes the statement <span class="texMathDisplay">\exists n.3n = x</span></p><p>Here are the first 15 multiples of 3 that this relation generates. Notice they are somewhat out of order, but all unique.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">&gt;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">map</span><span class="hspace">&nbsp;</span><span class="RktSym">base-ten</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">run</span><span class="hspace">&nbsp;</span><span class="RktVal">15</span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">multiple-of-3o-3n</span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">12</span><span class="hspace">&nbsp;</span><span class="RktVal">24</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="hspace">&nbsp;</span><span class="RktVal">48</span><span class="hspace">&nbsp;</span><span class="RktVal">15</span><span class="hspace">&nbsp;</span><span class="RktVal">21</span><span class="hspace">&nbsp;</span><span class="RktVal">96</span><span class="hspace">&nbsp;</span><span class="RktVal">27</span><span class="hspace">&nbsp;</span><span class="RktVal">39</span><span class="hspace">&nbsp;</span><span class="RktVal">18</span><span class="hspace">&nbsp;</span><span class="RktVal">33</span><span class="hspace">&nbsp;</span><span class="RktVal">45</span><span class="RktVal">)</span></td></tr></table></blockquote><p><div class="SIntrapara">I am comfortable converting the results back to base-ten because this relation <span style="font-weight: bold">fully grounds</span> its argument. In fact, this is true for all four implentations. I was not able to find a relation expressing divisibility by 3 which leaves part of the Oleg number fresh. </div><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>A value is <span style="font-weight: bold">fully ground</span> if it has no fresh variables.</p></blockquote></blockquote></blockquote></div></p><p>A different version of the same statement can be created by swapping <span class="RktSym">n</span> and <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktVal">)</span> in the relation definition. I&rsquo;ll call this the <span class="RktSym">n3</span> approach.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">defrel</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">multiple-of-3o-n3</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fresh</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">*o</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktSym">&gt;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">map</span><span class="hspace">&nbsp;</span><span class="RktSym">base-ten</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">run</span><span class="hspace">&nbsp;</span><span class="RktVal">15</span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">multiple-of-3o-n3</span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">12</span><span class="hspace">&nbsp;</span><span class="RktVal">24</span><span class="hspace">&nbsp;</span><span class="RktVal">48</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="hspace">&nbsp;</span><span class="RktVal">96</span><span class="hspace">&nbsp;</span><span class="RktVal">15</span><span class="hspace">&nbsp;</span><span class="RktVal">18</span><span class="hspace">&nbsp;</span><span class="RktVal">192</span><span class="hspace">&nbsp;</span><span class="RktVal">30</span><span class="hspace">&nbsp;</span><span class="RktVal">21</span><span class="hspace">&nbsp;</span><span class="RktVal">36</span><span class="hspace">&nbsp;</span><span class="RktVal">27</span><span class="RktVal">)</span></td></tr></table></blockquote><h3>2<tt>&nbsp;</tt><a name="(part._.Exploiting_the_structure_of_multiples_of_3)"></a>Exploiting the structure of multiples of 3</h3><p><div class="SIntrapara">A base-10 number is divisible by 3 if the sum of its digits is divisible by 3. A similer criterion exists for Oleg numerals. According to  <a href="https://stackoverflow.com/a/39386483/20284526"><span class="url">https://stackoverflow.com/a/39386483/20284526</span></a>, an Oleg number (referred to in the StackOverflow answer as a binary number "from the right") is divisible by 3 if the sum of its odd-indexed bits minus the sum of its even-indexed bits is divisible by 3. Mathematically, <span class="texMathDisplay">\sum_{\text{odd } i} x_i - \sum_{\text{even } i} x_i \equiv 0 \bmod 3</span> </div><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Since this is a necessary and sufficient condition, I&rsquo;m pretty sure that any correct implementation of the relation must fully ground its results.</p></blockquote></blockquote></blockquote></div></p><p>For example, <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">0</span><span class="stt"> </span><span class="RktVal">1</span><span class="RktVal">)</span> is divisible by 3 as demonstrated in the below picture.</p><p><img src="divisibility-of-267.png" alt="" width="477" height="313"/></p><p>Since this is a congruence mod 3, there are only a finite number of states to consider while adding up the odd- and even-indexed bits. At any point while scanning through the list of bits: 0 mod 3, 1 mod 3, and 2 mod 3. By considering these 3 possibilities, while also keeping track of whether the next bit is at an odd or even index, one can establish <span class="texMathInline">3 * 2 = 6</span> pairs of states such that, if the list is exhausted while on a 0 mod 3 state, the number is divisible by 3. Below is a deterministic finite automaton (DFA) which encodes this algorithm.</p><p><img src="divisibility-by-3-dfa-unminimized.png" alt="" width="941" height="650"/></p><p>While this DFA is correct, it can be minimized. I used an online tool at <a href="https://aswaddev.github.io/dfa-minimizer/"><span class="url">https://aswaddev.github.io/dfa-minimizer/</span></a> to produce a DFA with only 3 states:</p><p><img src="divisibility-by-3-dfa-minimized.png" alt="" width="413" height="210"/></p><p>Converting a DFA into a miniKanren relation is straightforward: proceed recursively through the list while maintaining a state (here represented as a symbol), and only accept an empty list if the current state is an accepting state. The translation from DFA to miniKanren clauses is mostly direct with one exception: encountering a 0 requires the tail of the list to be nonempty (a pair instead of the empty list), since Oleg numerals cannot end in 0.</p><p>The DFA encoded as a relation, <span class="RktSym">dfao</span> and its helper relation <span class="RktSym">pairo</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">defrel</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dfao</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktSym">state</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">conde</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">state</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">q1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">fresh</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">head</span><span class="hspace">&nbsp;</span><span class="RktSym">tail</span><span class="hspace">&nbsp;</span><span class="RktSym">next-state</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktRdr">,</span><span class="RktSym">head</span><span class="hspace">&nbsp;</span><span class="RktVal">. </span><span class="RktRdr">,</span><span class="RktSym">tail</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">conde</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">head</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pairo</span><span class="hspace">&nbsp;</span><span class="RktSym">tail</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">conde</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">state</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">q1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">next-state</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">q1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">state</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">q2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">next-state</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">q3</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">state</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">q3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">next-state</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">q2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">head</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">conde</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">state</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">q1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">next-state</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">q2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">state</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">q2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">next-state</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">q1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">state</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">q3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">next-state</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">q3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dfao</span><span class="hspace">&nbsp;</span><span class="RktSym">tail</span><span class="hspace">&nbsp;</span><span class="RktSym">next-state</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">defrel</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pairo</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fresh</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">d</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">l</span><span class="hspace">&nbsp;</span><span class="RktVal">`</span><span class="RktVal">(</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">. </span><span class="RktRdr">,</span><span class="RktSym">d</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>So the divisibility relation can be defined by referencing <span class="RktSym">dfao</span> on the starting state <span class="RktVal">'</span><span class="RktVal">q1</span>. I&rsquo;ll call it the <span class="RktSym">dfa</span> approach.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">defrel</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">multiple-of-3o-dfa</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">dfao</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">q1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktSym">&gt;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">map</span><span class="hspace">&nbsp;</span><span class="RktSym">base-ten</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">run</span><span class="hspace">&nbsp;</span><span class="RktVal">15</span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">multiple-of-3o-dfa</span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">15</span><span class="hspace">&nbsp;</span><span class="RktVal">12</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="hspace">&nbsp;</span><span class="RktVal">30</span><span class="hspace">&nbsp;</span><span class="RktVal">27</span><span class="hspace">&nbsp;</span><span class="RktVal">24</span><span class="hspace">&nbsp;</span><span class="RktVal">21</span><span class="hspace">&nbsp;</span><span class="RktVal">18</span><span class="hspace">&nbsp;</span><span class="RktVal">63</span><span class="hspace">&nbsp;</span><span class="RktVal">60</span><span class="hspace">&nbsp;</span><span class="RktVal">57</span><span class="hspace">&nbsp;</span><span class="RktVal">54</span><span class="RktVal">)</span></td></tr></table></blockquote><p>This looks unordered still, but look at the raw Oleg results:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">&gt;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">run</span><span class="hspace">&nbsp;</span><span class="RktVal">15</span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">multiple-of-3o-dfa</span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr></table></blockquote><p>They are still ordered by length.</p><h3>3<tt>&nbsp;</tt><a name="(part._.Enumerating_all_multiples_of_3)"></a>Enumerating all multiples of 3</h3><p>My last approach is to encode the following mathematical statement: <span class="texMathDisplay">x = 0 \lor x = 3 \lor x = 6 \lor x = 9 \lor x = 12 \ldots</span></p><p>This requires breaking the rules of miniKanren: creating a relation which relies on one of its arguments to always be ground. That way I can call functions (rather than relations) like <span class="RktSym">build-num</span> and <span class="RktSym">+</span>, since I am dealing with a number and never a fresh variable. This hack relation is not worthy of the conventional <span class="RktSym"><span class="nobreak">-o</span></span> suffix.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">defrel</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">danger!</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">ground</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">conde</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">==</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">build-num</span><span class="hspace">&nbsp;</span><span class="RktSym">ground</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">danger!</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktSym">ground</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>The divisibility relation can be defined by seeding an initial ground value of 0 to <span class="RktSym">danger!</span>. I will suffix it with <span class="RktSym">enum</span>.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">defrel</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">multiple-of-3o-enum</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">danger!</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktSym">&gt;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">map</span><span class="hspace">&nbsp;</span><span class="RktSym">base-ten</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">run</span><span class="hspace">&nbsp;</span><span class="RktVal">15</span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">multiple-of-3o-enum</span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="hspace">&nbsp;</span><span class="RktVal">12</span><span class="hspace">&nbsp;</span><span class="RktVal">15</span><span class="hspace">&nbsp;</span><span class="RktVal">18</span><span class="hspace">&nbsp;</span><span class="RktVal">21</span><span class="hspace">&nbsp;</span><span class="RktVal">24</span><span class="hspace">&nbsp;</span><span class="RktVal">27</span><span class="hspace">&nbsp;</span><span class="RktVal">30</span><span class="hspace">&nbsp;</span><span class="RktVal">33</span><span class="hspace">&nbsp;</span><span class="RktVal">36</span><span class="hspace">&nbsp;</span><span class="RktVal">39</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktVal">)</span></td></tr></table></blockquote><p>The results here are ordered.</p><h3>4<tt>&nbsp;</tt><a name="(part._.Start_your_engines)"></a>Start your engines</h3><p>For the first <span style="font-weight: bold">drag race</span>, I will run the following expression for each of the 4 implementations, and for increasing values of <span class="RktSym">n</span>. Only the cpu time is considered.</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">time</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">run</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">multiple-of-3o</span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">void</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote><p>The <span class="RktPn">(</span><span class="RktSym">void</span><span class="RktPn">)</span> call is a simple way to suppress the output of <span class="RktPn">(</span><span class="RktSym">run</span><span class="stt"> </span><span class="RktSym">n</span><span class="stt"> </span><span class="RktSym">...</span><span class="RktPn">)</span> while timing.</p><h3>5<tt>&nbsp;</tt><a name="(part._.Ready__set__go_)"></a>Ready, set, go!</h3><p><img src="divisibility-by-3-generate.png" alt="" width="756" height="425"/></p><p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktSym">n</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="RktSym">3n</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="RktSym">n3</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="RktSym">dfa</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="RktSym">enum</span></p></td></tr><tr><td><p>250</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>76</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>889</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>8</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td></tr><tr><td><p>500</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>168</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>3790</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>112</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td></tr><tr><td><p>750</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>410</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>8309</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>59</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td></tr><tr><td><p>1000</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>468</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>18165</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>54</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>1</p></td></tr><tr><td><p>1250</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>1033</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>22868</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>68</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>1</p></td></tr><tr><td><p>1500</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>1042</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>31357</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>123</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>1</p></td></tr><tr><td><p>1750</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>1036</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>42626</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>136</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>3</p></td></tr><tr><td><p>2000</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>1153</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>58484</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>130</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>3</p></td></tr><tr><td><p>5000</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>8342</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>-</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>383</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>8</p></td></tr><tr><td><p>10000</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>14033</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>-</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>1040</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>20</p></td></tr><tr><td><p>15000</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>15919</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>-</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>1858</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>27</p></td></tr><tr><td><p>20000</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>33743</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>-</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>2023</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>38</p></td></tr><tr><td><p>25000</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>35274</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>-</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>5149</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>58</p></td></tr><tr><td><p>30000</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>37538</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>-</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>5314</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>85</p></td></tr></table></p><p>I stopped measuring <span class="RktSym">n3</span> early on because it was doing horribly. What takes <span class="RktSym">enum</span> a handful of miliseconds takes nearly a minute for <span class="RktSym">n3</span>. Omitting <span class="RktSym">n3</span> for higher inputs allows seeing real differences among the other 3 implementations. One easy takeaway is that if you&rsquo;re comfortable doing a divisibility against a constant value by using the existential approach with <span class="RktSym">*o</span>, make sure the constant is the first value, not the second! It makes a huge difference.</p><p>So it looks like enum is the best choice, but that&rsquo;s only for generating values from a fresh variable. What if you want to use the relation to test if an already-fully-ground value is divisible by 3?</p><p>Here is the code template for the next drag race. Here we just want to find one answer, <span class="RktPn">(</span><span class="RktVar">.0</span><span class="RktPn">)</span>, to indicate that the number <span class="RktSym">x</span>, (some variation of 999...) is indeed a multiple of 3.</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">time</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">run</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">multiple-of-3o-enum</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">build-num</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote><p><img src="divisibility-by-3-test.png" alt="" width="756" height="425"/></p><p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktSym">10&#8319;&#8722;1</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="RktSym">3n</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="RktSym">n3</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="RktSym">dfa</span></p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p><span class="RktSym">enum</span></p></td></tr><tr><td><p>1</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>1</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td></tr><tr><td><p>2</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>7</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td></tr><tr><td><p>3</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>1</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>775</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td></tr><tr><td><p>4</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>2</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>82604</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>1</p></td></tr><tr><td><p>5</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>4</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>-</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>18</p></td></tr><tr><td><p>6</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>10</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>-</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>163</p></td></tr><tr><td><p>7</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>14</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>-</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>2329</p></td></tr><tr><td><p>8</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>23</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>-</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>0</p></td><td><p><span class="hspace">&nbsp;</span></p></td><td><p>26567</p></td></tr></table></p><p>But now at higher values of <span class="RktSym">x</span>, <span class="RktSym">enum</span> starts to do badly! That is becasue it fully enumerates every multiple of 3 in order, and there are many, many multiples of 3 that come before 99999999. <span class="RktSym">dfa</span> remains speedy because it actually explores the Oleg number it is given, so its runtime depends only on the bitlength of the Oleg number rather than the value, which can be up to <span class="texMathInline">2^n</span> for some bitlength <span class="texMathInline">n</span>. <span class="RktSym">3n</span> also seems to be faring fine, which surprised me.</p></div></div><div id="contextindicator">&nbsp;</div></body></html>